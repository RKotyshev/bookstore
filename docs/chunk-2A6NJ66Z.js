import{a as mt,b as st,c as lt}from"./chunk-GNIWLWKQ.js";import{b as nt,c as at}from"./chunk-H5BM6KAL.js";import{a as tt,b as et,d as it,g as rt,h as ot}from"./chunk-YFMA2WRT.js";import"./chunk-GEXEHXWH.js";import{b as L,d as g,g as K,h as $,k as H,n as Y,o as J,q as Q,s as W}from"./chunk-HI7ESUXO.js";import{Ca as s,Cb as k,Eb as B,Hb as q,I as V,Ia as c,Kb as A,Na as a,O as D,Oa as o,Oc as G,Pa as u,Pc as U,Sc as z,T as x,Ta as F,U as C,Vc as X,W as b,Wc as Z,Xa as M,Xc as R,Y as j,Z as v,Za as f,a as h,ba as w,bb as n,ca as S,i as T,ib as O,jb as P,ta as p,u as _,ua as d,wa as N}from"./chunk-JJ4NW3S2.js";function pt(e,t){return m=>{let r=m.get(e),i=m.get(t),l=r.value===i.value,I=r.dirty&&i.dirty;return!l&&I?{identicalValues:!0}:null}}var dt="https://bookstore-api.wis-software.ru/api";var E=(()=>{let t=class t{constructor(r){this._http=r,this._registrationUrl=`${dt}/users`}isAvailableEmail(r){let i={email:r};return this._http.get(`${this._registrationUrl}/available/`,{params:i}).pipe(_(l=>l.isAvailable))}registerUser(r){let i=h({},r);return this._http.post(`${this._registrationUrl}/`,i)}};t.\u0275fac=function(i){return new(i||t)(b(A))},t.\u0275prov=x({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var ut=(()=>{let t=class t{constructor(r){this._registrationService=r}validate(r){let i=r.value;return this._registrationService.isAvailableEmail(i).pipe(_(l=>l?null:{availableEmail:!0}))}};t.\u0275fac=function(i){return new(i||t)(b(E))},t.\u0275prov=x({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function xt(e,t){e&1&&(a(0,"h2"),n(1,"Registration"),o())}function Ct(e,t){e&1&&(a(0,"mat-error"),n(1," This field is required "),o())}function bt(e,t){e&1&&(a(0,"mat-error"),n(1," Email already exists "),o())}function vt(e,t){e&1&&u(0,"mat-spinner",12),e&2&&s("diameter",20)}function yt(e,t){e&1&&(a(0,"mat-error"),n(1," This field is required "),o())}function Et(e,t){e&1&&(a(0,"mat-error"),n(1," This field is required "),o())}function It(e,t){e&1&&(a(0,"mat-error"),n(1," Passwords don't match "),o())}function wt(e,t){e&1&&(a(0,"mat-error"),n(1," Some error was occurred. Try again later "),o())}function St(e,t){if(e&1){let m=F();a(0,"form",4)(1,"mat-form-field",5)(2,"mat-label"),n(3,"Enter your email:"),o(),u(4,"input",6),c(5,Ct,2,0,"mat-error",0)(6,bt,2,0,"mat-error",0)(7,vt,1,1,"mat-spinner",7),O(8,"async"),o(),a(9,"mat-form-field")(10,"mat-label"),n(11,"Enter your password:"),o(),u(12,"input",8),c(13,yt,2,0,"mat-error",0),o(),a(14,"mat-form-field")(15,"mat-label"),n(16,"Confirm your password:"),o(),u(17,"input",9),c(18,Et,2,0,"mat-error",0),o(),c(19,It,2,0,"mat-error",0)(20,wt,2,0,"mat-error",0),a(21,"section")(22,"button",10),M("click",function(){w(m);let i=f();return S(i.onSubmit())}),n(23,"Sign up"),o(),a(24,"p"),n(25,"Do you have an account?"),o(),a(26,"a",11),n(27,"Log in"),o()()()}if(e&2){let m=f();s("formGroup",m.registrationForm),p(5),s("ngIf",m.emailControl.hasError("required")),p(),s("ngIf",m.emailControl.hasError("availableEmail")),p(),s("ngIf",P(8,8,m.emailControl.statusChanges)==="PENDING"),p(6),s("ngIf",m.passwordControl.hasError("required")),p(5),s("ngIf",m.passwordConfirmControl.hasError("required")),p(),s("ngIf",m.registrationForm.hasError("identicalValues")),p(),s("ngIf",m.submitError)}}function Ft(e,t){e&1&&(a(0,"section",13)(1,"h4"),n(2,"Please wait.."),o(),u(3,"mat-spinner",14),o())}function Mt(e,t){if(e&1){let m=F();a(0,"div",15)(1,"h2"),n(2,"Registration was successful"),o(),a(3,"p"),n(4," You will be redirected to the "),a(5,"a",16),n(6,"authorization page"),o(),n(7," in "),a(8,"app-display-timer",17),M("timerFinished",function(){w(m);let i=f();return S(i.onRedirect())}),o(),n(9," seconds "),o()()}if(e&2){let m=f();p(8),s("timerDelay",m.redirectDelaySeconds)}}var ft=(()=>{let t=class t{constructor(r,i,l,I,ht){this._formBuilder=r,this._availableEmailValidator=i,this._registrationService=l,this._router=I,this._cdr=ht,this.submitted=!1,this.redirectDelaySeconds=9,this.submitError=!1,this.submitting=!1,this._destroyed=new T}get emailControl(){return this.registrationForm.get("email")}get passwordControl(){return this.registrationForm.get("password")}get passwordConfirmControl(){return this.registrationForm.get("passwordConfirm")}ngOnInit(){this._initForm()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}onSubmit(){if(this.registrationForm.invalid)return;this.submitting=!0;let r=h({},this.registrationForm.getRawValue());delete r.passwordConfirm,this._registrationService.registerUser(r).pipe(V(()=>{this._cdr.markForCheck(),this.submitting=!1}),D(this._destroyed)).subscribe({next:()=>{this.submitted=!0,this.submitError=!1},error:()=>{this.submitError=!0}})}onRedirect(){this._router.navigate(["/authorization"])}_initForm(){this.registrationForm=this._formBuilder.group({email:this._formBuilder.control({value:"",disabled:!1},{validators:[g.email,g.required],asyncValidators:[this._availableEmailValidator.validate.bind(this._availableEmailValidator)],updateOn:"blur"}),password:this._formBuilder.control({value:"",disabled:!1},{validators:[g.required]}),passwordConfirm:this._formBuilder.control({value:"",disabled:!1},{validators:[g.required]})},{validators:[pt("password","passwordConfirm")]})}};t.\u0275fac=function(i){return new(i||t)(d(Q),d(ut),d(E),d(X),d(N))},t.\u0275cmp=j({type:t,selectors:[["app-registration"]],decls:4,vars:4,consts:[[4,"ngIf"],[3,"formGroup",4,"ngIf"],["class","submitting",4,"ngIf"],["class","submitted",4,"ngIf"],[3,"formGroup"],[1,"emailField"],["matInput","","formControlName","email","type","email"],["matSuffix","",3,"diameter",4,"ngIf"],["matInput","","formControlName","password","type","password"],["matInput","","formControlName","passwordConfirm","type","password"],["mat-fab","","extended","","color","primary","type","submit",3,"click"],["mat-fab","","extended","","routerLink","/authorization","color","accent"],["matSuffix","",3,"diameter"],[1,"submitting"],["diameter","50"],[1,"submitted"],["routerLink","/authorization"],[3,"timerDelay","timerFinished"]],template:function(i,l){i&1&&c(0,xt,2,0,"h2",0)(1,St,28,10,"form",1)(2,Ft,4,0,"section",2)(3,Mt,10,1,"div",3),i&2&&(s("ngIf",!l.submitted),p(),s("ngIf",!l.submitted),p(),s("ngIf",l.submitting),p(),s("ngIf",l.submitted))},dependencies:[k,H,L,K,$,Y,J,rt,tt,et,it,nt,U,G,mt,lt,Z,B],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:280px;max-width:500px;margin:0 auto 20px}mat-spinner[_ngcontent-%COMP%]{margin-right:10px}button[_ngcontent-%COMP%]{width:100%;margin:20px 0}p[_ngcontent-%COMP%]{width:100%;text-align:center}a[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.submitting[_ngcontent-%COMP%], .submitted[_ngcontent-%COMP%]{margin-bottom:20px}"],changeDetection:0});let e=t;return e})();var Rt=[{path:"",component:ft}],gt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=v({type:t}),t.\u0275inj=C({imports:[R.forChild(Rt),R]});let e=t;return e})();var pe=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=v({type:t}),t.\u0275inj=C({imports:[q,W,ot,at,z,st,gt]});let e=t;return e})();export{pe as RegistrationModule};
