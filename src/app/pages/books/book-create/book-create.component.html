<div *ngIf="!submitted">
  <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
    <h2>Create book</h2>

    <div>
      <mat-form-field>
        <mat-label>Book title</mat-label>
        <input matInput formControlName="title" type="text">
        <mat-hint align="end">{{ title.value.length }}/25</mat-hint>
        <mat-error *ngIf="title.invalid">{{ getErrorMessage(title) }}</mat-error>
        <mat-error></mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Book description</mat-label>
        <input matInput formControlName="description" type="text">
        <mat-error *ngIf="description.invalid">{{ getErrorMessage(description) }}</mat-error>
      </mat-form-field>
    </div>

    <div>
      <mat-form-field>
        <mat-label>Authors</mat-label>
        <mat-select multiple formControlName="author">
          <mat-option *ngFor="let currentAuthor of authors$ | async" [value]="currentAuthor.id">
            {{ currentAuthor | fullname }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="author.invalid">{{ getErrorMessage(author) }}</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Genres</mat-label>
        <mat-select multiple formControlName="genres">
          <mat-option *ngFor="let currentGenre of genres$ | async" [value]="currentGenre.id">
            {{ currentGenre.title }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="genres.invalid">{{ getErrorMessage(genres) }}</mat-error>
      </mat-form-field>
    </div>

    <div>
      <mat-form-field>
        <mat-label>Writing date</mat-label>
        <input 
          matInput
          formControlName="writing_date"
          [matDatepicker]="writingPicker"
          [max]="release_date.value"
          >
        <mat-datepicker-toggle matIconSuffix [for]="writingPicker"></mat-datepicker-toggle>
        <mat-datepicker #writingPicker></mat-datepicker>
        <mat-hint>YYYY-MM-DD</mat-hint>
        <mat-error *ngIf="writing_date.invalid">{{ getErrorMessage(writing_date) }}</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Release date</mat-label>
        <input 
          matInput
          formControlName="release_date"
          [matDatepicker]="releasePicker"
          [min]="writing_date.value"
          >
        <mat-datepicker-toggle matIconSuffix [for]="releasePicker"></mat-datepicker-toggle>
        <mat-datepicker #releasePicker></mat-datepicker>
        <mat-hint>YYYY-MM-DD</mat-hint>
        <mat-error *ngIf="release_date.invalid">{{ getErrorMessage(release_date) }}</mat-error>
      </mat-form-field>
    </div>

    <div>
      <mat-form-field>
        <mat-label>In stock</mat-label>
        <input matInput formControlName="in_stock" type="number" min="0">
        <mat-error *ngIf="in_stock.invalid">{{ getErrorMessage(in_stock) }}</mat-error>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Price</mat-label>
        <input matInput formControlName="price" type="number" min="0">
        <mat-error *ngIf="price.invalid">{{ getErrorMessage(price) }}</mat-error>
      </mat-form-field>
    </div>

    <mat-error *ngIf="bookForm.hasError('datesCompare')">
      Writing date must be less than the release date
    </mat-error>
    <mat-error *ngIf="submitError">
      Some error was occurred. Try again later
    </mat-error>

    <button mat-raised-button type="submit">Create</button>
  </form>
</div>

<div *ngIf="submitted">
  <h2>New book created!</h2>
  <p>
    You will be redirected to the
     <a routerLink="/books">books list page</a>
      in 
    <app-display-timer [timerDelay]="redirectDelaySeconds" (timerFinished)="onRedirect()"></app-display-timer>
     seconds
  </p>
</div>